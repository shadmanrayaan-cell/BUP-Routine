<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Academic Routine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        :root {
            --ios-blue: #007aff;
            --bg-system: #f8f9fc;
            --nav-height: 85px;
            --accent-primary: #4f46e5;
            --accent-secondary: #1e1b4b;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg-system); 
            color: #1c1c1e;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* --- Updated Header with Dotted Design --- */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background-color: var(--accent-secondary);
            background-image: 
                radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 24px 24px; /* Adjust dot density */
            color: white;
            padding-top: env(safe-area-inset-top, 20px);
            overflow: hidden;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        /* Ambient glow effect from the image */
        .header-graphic {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150%;
            height: 150%;
            background: radial-gradient(circle at center, rgba(79, 70, 229, 0.15) 0%, transparent 60%);
            z-index: 0;
            pointer-events: none;
        }

        .header-content {
            position: relative;
            z-index: 1;
            padding: 30px 24px 35px 24px;
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 4px 12px;
            border-radius: 100px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }

        /* --- Main Layout --- */
        main {
            padding: 24px 20px;
            padding-bottom: calc(var(--nav-height) + 60px);
            min-height: 80vh;
        }

        .nav-wrapper {
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            z-index: 2000;
            pointer-events: none;
        }

        .glass-nav {
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(25px) saturate(160%);
            -webkit-backdrop-filter: blur(25px) saturate(160%);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            border-radius: 35px;
            display: flex;
            width: 92%;
            max-width: 480px;
            height: 78px;
            padding: 0 10px;
        }

        .bottom-mask {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 140px;
            background: linear-gradient(to top, var(--bg-system) 40%, transparent);
            z-index: 1500;
            pointer-events: none;
        }

        .nav-btn {
            flex: 1;
            border: none;
            background: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
            gap: 4px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .nav-btn.active { color: var(--accent-primary); }
        .nav-btn i { font-size: 1.5rem; }
        .nav-btn span { font-size: 10px; font-weight: 700; }

        .card {
            background: white;
            border-radius: 28px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid rgba(0,0,0,0.03);
            box-shadow: 0 4px 12px rgba(0,0,0,0.02);
        }

        .hidden { display: none !important; }

        /* Onboarding Overlay */
        #onboarding-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-primary) !important;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 4px 12px;
            border-radius: 100px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Day Chips */
        .day-chip {
            padding: 8px 0;
            text-align: center;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 800;
            cursor: pointer;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
            background: #f8fafc;
            color: #64748b;
        }
        .day-chip.selected {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.2);
        }
    </style>
</head>
<body> 

    <!-- ONBOARDING SECTION -->
    <div id="onboarding-overlay" class="hidden">
        <div class="w-full max-w-lg bg-white p-6 sm:p-8 rounded-[2.5rem] shadow-2xl border border-slate-100 flex flex-col min-h-[500px]">
            <div class="text-center mb-6">
                <div class="w-14 h-14 bg-indigo-600 rounded-2xl flex items-center justify-center text-white text-xl mx-auto mb-3">
                    <i class="fa-solid fa-calendar-check"></i>
                </div>
                <h1 class="text-xl font-extrabold text-slate-900">Setup Routine</h1>
                <p id="setup-step-desc" class="text-[11px] text-slate-500 font-medium">Choose your schedule type to continue</p>
            </div>

            <div id="setup-mode-toggle" class="flex bg-slate-100 p-1 rounded-2xl mb-6">
                <button onclick="toggleSetupMode('default')" id="btn-mode-default" class="flex-1 py-3 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all bg-white shadow-sm text-indigo-600">
                    Default Routine
                </button>
                <button onclick="toggleSetupMode('custom')" id="btn-mode-custom" class="flex-1 py-3 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all text-slate-400">
                    Custom Routine
                </button>
            </div>

            <div id="setup-view-0" class="flex-1 flex flex-col justify-center">
                <div id="setup-default-view" class="mb-6 bg-indigo-50/50 p-4 rounded-2xl border border-indigo-100">
                    <p class="text-[10px] font-bold text-indigo-600 uppercase mb-2">Included Courses:</p>
                    <div class="text-[11px] text-indigo-900/70 font-semibold space-y-1">
                        • Principles of Marketing (Jobaida Tohfa)<br>
                        • Functional English & PSD (Dr. Atikur Rahman)<br>
                        • Principles of Management (Sabbir Ahmed)<br>
                        • Bangladesh Studies (Farhana Amin Ahmed)<br>
                        • Introduction to Business (Rakib Hasan Anik)
                    </div>
                </div>
                <button onclick="finishSetup()" class="w-full bg-indigo-600 text-white py-5 rounded-2xl font-black text-xs uppercase tracking-[0.2em] shadow-lg shadow-indigo-100 hover:scale-[1.02] transition-all">
                    Launch Routine
                </button>
            </div>

            <div id="setup-view-custom" class="hidden flex-1 flex flex-col">
                <div id="wizard-form" class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span id="wizard-counter" class="text-[10px] font-black text-indigo-600 uppercase">Course 1</span>
                        <div class="flex gap-1" id="wizard-dots"></div>
                    </div>
                    
                    <div>
                        <label class="text-[9px] font-black uppercase text-slate-400 ml-1">Course Name</label>
                        <input type="text" id="wiz-name" placeholder="e.g. Intro To Business" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm font-semibold mt-1">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[9px] font-black uppercase text-slate-400 ml-1">Faculty</label>
                            <input type="text" id="wiz-fac" placeholder="Name" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm font-semibold mt-1">
                        </div>
                        <div>
                            <label class="text-[9px] font-black uppercase text-slate-400 ml-1">Room</label>
                            <input type="text" id="wiz-rm" placeholder="CR-101" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm font-semibold mt-1">
                        </div>
                    </div>

                    <div>
                        <label class="text-[9px] font-black uppercase text-slate-400 ml-1">Select Days</label>
                        <div class="grid grid-cols-5 gap-2 mt-1" id="wiz-days">
                            <div class="day-chip" onclick="toggleDay(this, 'Sunday')">SUN</div>
                            <div class="day-chip" onclick="toggleDay(this, 'Monday')">MON</div>
                            <div class="day-chip" onclick="toggleDay(this, 'Tuesday')">TUE</div>
                            <div class="day-chip" onclick="toggleDay(this, 'Wednesday')">WED</div>
                            <div class="day-chip" onclick="toggleDay(this, 'Thursday')">THU</div>
                        </div>
                    </div>

                    <div>
                        <label class="text-[9px] font-black uppercase text-slate-400 ml-1">Class Timing</label>
                        <div class="flex items-center gap-2 mt-1">
                            <input type="text" id="wiz-start" placeholder="12:00" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-3 text-sm font-semibold">
                            <span class="text-slate-300 font-bold">-</span>
                            <input type="text" id="wiz-end" placeholder="01:30" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-3 text-sm font-semibold">
                            <select id="wiz-p" class="bg-slate-200 rounded-xl px-2 py-3 text-[10px] font-black">
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="setup-error" class="hidden mt-4 p-3 bg-red-50 text-red-500 rounded-xl text-[10px] font-bold flex items-center gap-2">
                    <i class="fa-solid fa-circle-exclamation"></i> Fill all fields and select at least one day.
                </div>

                <div class="flex gap-3 mt-auto pt-6">
                    <button id="wiz-btn-finish" onclick="finishSetup()" class="hidden flex-1 bg-emerald-600 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-lg shadow-emerald-100">
                        Finish & Save
                    </button>
                    <button id="wiz-btn-next" onclick="nextWizardStep()" class="flex-1 bg-indigo-600 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-lg shadow-indigo-100">
                        Next Course
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <header class="app-header shadow-2xl">
        <div class="header-graphic"></div>
        <div class="header-content max-w-4xl mx-auto">
            <div class="flex justify-between items-start mb-8">
                <div class="status-pill">
                    
                    <span id="day-status">Built By Shadman</span>
                </div>
                <div class="text-right">
                    <div id="clock" class="text-2xl font-black tracking-tighter tabular-nums">00:00:00</div>
                    <div id="date-label" class="text-[10px] font-bold opacity-50 tracking-[0.2em] uppercase">Sunday, Feb 01</div>
                </div>
            </div>
            <div class="flex items-end justify-between">
                <div>
                    <h1 class="text-4xl font-extrabold tracking-tight leading-none mb-2">Academic Routine</h1>
                    <div id="routine-type-tag" class="flex items-center gap-2">
                        <span class="bg-indigo-500/20 text-indigo-200 text-[10px] font-black px-2 py-0.5 rounded-md uppercase border border-indigo-500/30">Bangladesh University of Professionals </span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto">
        <section id="view-today" class="view-section">
            <h3 class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4">Current Schedule</h3>
            <div id="today-list" class="space-y-4"></div>
        </section>

        <section id="view-weekly" class="view-section hidden">
            <div id="weekly-list" class="space-y-6"></div>
        </section>

        <section id="view-tasks" class="view-section hidden">
            <div class="card">
                <h2 class="text-xl font-bold mb-6">Academic Tasks</h2>
                <div class="flex gap-2 mb-8">
                    <input type="text" id="task-in" placeholder="Enter academic task..." class="flex-1 bg-slate-50 border-none rounded-2xl px-6 py-4 text-sm font-medium">
                    <button onclick="addTask()" class="bg-indigo-600 text-white px-8 rounded-2xl font-bold text-sm shadow-lg shadow-indigo-100">Add</button>
                </div>
                <div id="task-list" class="space-y-3"></div>
            </div>
        </section>

        <section id="view-gpa" class="view-section hidden">
            <div class="card text-center">
                <h2 class="text-xl font-black mb-8">GPA Calculator</h2>
                <div id="gpa-rows"></div>
                <button onclick="addGpaRow()" class="w-full py-5 rounded-2xl border-2 border-dashed border-slate-200 text-slate-400 text-[10px] font-black uppercase mt-4">+ Add Course</button>
                <div class="mt-8 bg-slate-900 rounded-[2.5rem] p-10 text-white shadow-2xl">
                    <span class="text-[11px] font-black text-indigo-400 uppercase tracking-[0.3em] block mb-2">Projected Score</span>
                    <div id="gpa-val" class="text-7xl font-black tracking-tighter">0.00</div>
                </div>
            </div>
        </section>

        <section id="view-faculty" class="view-section hidden">
            <div id="faculty-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
        </section>
    </main>

    <div class="nav-wrapper">
        <nav class="glass-nav">
            <button onclick="tab('today')" id="btn-today" class="nav-btn active"><i class="fa-solid fa-home"></i><span>Today</span></button>
            <button onclick="tab('weekly')" id="btn-weekly" class="nav-btn"><i class="fa-solid fa-calendar"></i><span>Routine</span></button>
            <button onclick="tab('tasks')" id="btn-tasks" class="nav-btn"><i class="fa-solid fa-list-check"></i><span>Tasks</span></button>
            <button onclick="tab('gpa')" id="btn-gpa" class="nav-btn"><i class="fa-solid fa-graduation-cap"></i><span>GPA</span></button>
            <button onclick="tab('faculty')" id="btn-faculty" class="nav-btn"><i class="fa-solid fa-id-badge"></i><span>Faculty</span></button>
        </nav>
    </div>

    <script>
        const DEFAULT_ROUTINE = {
            "Sunday": [
                { s: "08:30 AM", e: "10:00 AM", sub: "Principles of Management", fac: "Sabbir Ahmed", rm: "CR-502" },
                { s: "12:00 PM", e: "01:30 PM", sub: "Principles of Marketing", fac: "Jobaida Tohfa", rm: "CR-502" },
                { s: "02:00 PM", e: "03:30 PM", sub: "Functional English & PSD", fac: "Dr. Atikur Rahman", rm: "CR-501" }
            ],
            "Monday": [
                { s: "12:00 PM", e: "01:30 PM", sub: "Principles of Management", fac: "Sabbir Ahmed", rm: "CR-604" },
                { s: "03:45 PM", e: "05:15 PM", sub: "Bangladesh Studies", fac: "Farhana Amin", rm: "CR-604" }
            ],
            "Tuesday": [
                { s: "08:30 AM", e: "10:00 AM", sub: "Functional English & PSD", fac: "Dr. Atikur Rahman", rm: "CR-603" },
                { s: "12:00 PM", e: "01:30 PM", sub: "Introduction to Business", fac: "Rakib Hasan Anik", rm: "CR-603" },
                { s: "02:00 PM", e: "03:15 PM", sub: "Bangladesh Studies", fac: "Farhana Amin", rm: "CR-604" }
            ],
            "Wednesday": [
                {  sub: "Research Work" }
            ],
            "Thursday": [
                { s: "02:00 PM", e: "03:30 PM", sub: "Bangladesh Studies", fac: "TBA", rm: "CR-503" },
                { s: "03:45 PM", e: "05:15 PM", sub: "Introduction to Business", fac: "Rakib Hasan Anik", rm: "CR-603" }
            ],
            "Friday": [], "Saturday": []
        };

        const FACULTY = [
            { n: "Jobaida Tohfa", r: "Lecturer", p: "01769028360", id: "JT" },
            { n: "Rakib Hasan Anik", r: "Lecturer", p: "01769028358", id: "RA" },
            { n: "Dr. Atikur Rahman", r: "Assoc. Prof", p: "01670700303", id: "AR" }
        ];

        let routine = JSON.parse(localStorage.getItem('mgt_routine_v2')) || DEFAULT_ROUTINE;
        let setupMode = 'default';
        let wizardStep = 1;
        let customCourses = []; // Now stores {..., days: []}
        let selectedWizardDays = [];

        let state = {
            activeTab: 'today',
            tasks: JSON.parse(localStorage.getItem('mgt_tasks_v2')) || [],
            gpa: JSON.parse(localStorage.getItem('mgt_gpa_v2')) || [{id: 1, cr: 3, gr: 4.0}]
        };

        // --- Onboarding Logic ---
        function checkFirstTime() {
            if (!localStorage.getItem('onboarding_v2_complete')) {
                document.getElementById('onboarding-overlay').classList.remove('hidden');
            }
        }

        function toggleSetupMode(mode) {
            setupMode = mode;
            const isDefault = mode === 'default';
            document.getElementById('btn-mode-default').className = isDefault ? 'flex-1 py-3 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all bg-white shadow-sm text-indigo-600' : 'flex-1 py-3 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all text-slate-400';
            document.getElementById('btn-mode-custom').className = !isDefault ? 'flex-1 py-3 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all bg-white shadow-sm text-indigo-600' : 'flex-1 py-3 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all text-slate-400';
            
            document.getElementById('setup-view-0').classList.toggle('hidden', !isDefault);
            document.getElementById('setup-view-custom').classList.toggle('hidden', isDefault);
            document.getElementById('setup-step-desc').innerText = isDefault ? 'Choose your schedule type to continue' : 'Add your first course details';
            
            if (!isDefault) renderWizardDots();
        }

        function toggleDay(el, day) {
            if (selectedWizardDays.includes(day)) {
                selectedWizardDays = selectedWizardDays.filter(d => d !== day);
                el.classList.remove('selected');
            } else {
                selectedWizardDays.push(day);
                el.classList.add('selected');
            }
        }

        function renderWizardDots() {
            const container = document.getElementById('wizard-dots');
            container.innerHTML = Array(wizardStep).fill(0).map((_, i) => `<div class="w-1.5 h-1.5 rounded-full ${i === wizardStep-1 ? 'bg-indigo-600' : 'bg-indigo-200'}"></div>`).join('');
            document.getElementById('wizard-counter').innerText = `Course ${wizardStep}`;
        }

        function nextWizardStep() {
            const sub = document.getElementById('wiz-name').value;
            const fac = document.getElementById('wiz-fac').value;
            const rm = document.getElementById('wiz-rm').value;
            const s = document.getElementById('wiz-start').value;
            const e = document.getElementById('wiz-end').value;
            const p = document.getElementById('wiz-p').value;

            if (!sub || !fac || !rm || !s || !e || selectedWizardDays.length === 0) {
                document.getElementById('setup-error').classList.remove('hidden');
                return;
            }

            document.getElementById('setup-error').classList.add('hidden');
            customCourses.push({ s: `${s} ${p}`, e: `${e} ${p}`, sub, fac, rm, days: [...selectedWizardDays] });

            // Reset UI
            document.getElementById('wiz-name').value = '';
            document.getElementById('wiz-fac').value = '';
            document.getElementById('wiz-rm').value = '';
            document.getElementById('wiz-start').value = '';
            document.getElementById('wiz-end').value = '';
            selectedWizardDays = [];
            document.querySelectorAll('.day-chip').forEach(c => c.classList.remove('selected'));
            
            wizardStep++;
            renderWizardDots();
            document.getElementById('wiz-btn-finish').classList.remove('hidden');
        }

        function finishSetup() {
            if (setupMode === 'default') {
                routine = DEFAULT_ROUTINE;
                document.getElementById('routine-type-tag').innerHTML = '<span class="bg-indigo-500/20 text-indigo-200 text-[10px] font-black px-2 py-0.5 rounded-md uppercase border border-indigo-500/30">MGT-2026 DEFAULT</span>';
            } else {
                // Try to save the current form data if any
                const sub = document.getElementById('wiz-name').value;
                if(sub && selectedWizardDays.length > 0) {
                    const fac = document.getElementById('wiz-fac').value;
                    const rm = document.getElementById('wiz-rm').value;
                    const s = document.getElementById('wiz-start').value;
                    const e = document.getElementById('wiz-end').value;
                    const p = document.getElementById('wiz-p').value;
                    customCourses.push({ s: `${s} ${p}`, e: `${e} ${p}`, sub, fac, rm, days: [...selectedWizardDays] });
                }

                if (customCourses.length === 0) {
                    document.getElementById('setup-error').classList.remove('hidden');
                    return;
                }

                // Map custom courses to the routine object
                const newRoutine = { "Sunday":[], "Monday":[], "Tuesday":[], "Wednesday":[], "Thursday":[], "Friday":[], "Saturday":[] };
                customCourses.forEach(course => {
                    course.days.forEach(day => {
                        // Create a clean course object without the days array for storage
                        const entry = { s: course.s, e: course.e, sub: course.sub, fac: course.fac, rm: course.rm };
                        newRoutine[day].push(entry);
                    });
                });
                
                // Sort each day by start time (simple string sort works for most basic time formats)
                Object.keys(newRoutine).forEach(day => {
                    newRoutine[day].sort((a, b) => a.s.localeCompare(b.s));
                });

                routine = newRoutine;
                document.getElementById('routine-type-tag').innerHTML = '<span class="bg-emerald-500/20 text-emerald-200 text-[10px] font-black px-2 py-0.5 rounded-md uppercase border border-emerald-500/30">CUSTOM ROUTINE</span>';
            }

            localStorage.setItem('mgt_routine_v2', JSON.stringify(routine));
            localStorage.setItem('onboarding_v2_complete', 'true');
            document.getElementById('onboarding-overlay').classList.add('hidden');
            render();
        }

        // --- Core App Functions ---
        function tab(name) {
            state.activeTab = name;
            document.querySelectorAll('.view-section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`view-${name}`).classList.remove('hidden');
            document.getElementById(`btn-${name}`).classList.add('active');
            render();
        }

        function render() {
            const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            const currentDay = dayNames[new Date().getDay()];

            if(state.activeTab === 'today') {
                const list = routine[currentDay] || [];
                document.getElementById('today-list').innerHTML = list.length ? list.map(c => `
                    <div class="card flex items-center gap-5">
                        <div class="w-14 h-14 bg-slate-50 text-indigo-600 rounded-2xl flex flex-col items-center justify-center font-black">
                            <span class="text-[9px] opacity-40">${c.s.split(' ')[0]}</span>
                            <span class="text-xs">${c.s.split(' ')[1]}</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-extrabold text-slate-800 text-sm">${c.sub}</h4>
                            <p class="text-[10px] text-slate-400 font-bold mt-1 uppercase">${c.rm} • ${c.fac}</p>
                        </div>
                    </div>
                `).join('') : '<div class="card text-center py-10 text-slate-300 font-bold italic">No classes today</div>';
            }

            if(state.activeTab === 'weekly') {
                const activeDays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday"];
                document.getElementById('weekly-list').innerHTML = activeDays.map(day => `
                    <div class="card p-0 overflow-hidden ${day === currentDay ? 'ring-2 ring-indigo-500 shadow-xl' : ''}">
                        <div class="bg-slate-50 px-5 py-3 border-b border-slate-100 flex justify-between items-center">
                            <span class="text-[10px] font-black uppercase text-slate-800">${day}</span>
                            ${day === currentDay ? '<span class="text-[8px] bg-indigo-600 text-white px-2 py-0.5 rounded-full font-bold">TODAY</span>' : ''}
                        </div>
                        <div class="p-5 space-y-4">
                            ${routine[day].map(c => `
                                <div class="flex justify-between items-center text-xs">
                                    <div>
                                        <p class="font-bold text-slate-800">${c.sub}</p>
                                        <p class="text-[9px] text-slate-400 font-bold uppercase mt-0.5">${c.s} - ${c.e}</p>
                                    </div>
                                    <span class="text-[9px] font-black text-indigo-600 bg-indigo-50 px-2 py-1 rounded-lg">${c.rm}</span>
                                </div>
                            `).join('') || '<p class="text-[9px] text-slate-300 italic">No classes scheduled</p>'}
                        </div>
                    </div>
                `).join('');
            }

            if(state.activeTab === 'tasks') {
                document.getElementById('task-list').innerHTML = state.tasks.map((t, i) => `
                    <div class="flex items-center justify-between p-4 bg-white rounded-2xl border border-slate-100">
                        <span class="text-sm font-semibold text-slate-700">${t.txt}</span>
                        <button onclick="delTask(${i})" class="text-slate-200 hover:text-red-400"><i class="fa-solid fa-circle-minus"></i></button>
                    </div>
                `).join('');
            }

            if(state.activeTab === 'gpa') {
                document.getElementById('gpa-rows').innerHTML = state.gpa.map(r => `
                    <div class="grid grid-cols-3 gap-3 mb-3">
                        <input type="number" value="${r.cr}" onchange="upGpa(${r.id},'cr',this.value)" class="bg-slate-50 rounded-xl py-3 text-center text-xs font-bold border-none">
                        <select onchange="upGpa(${r.id},'gr',this.value)" class="bg-slate-50 rounded-xl py-3 px-2 text-xs font-bold border-none">
                            <option value="4.0" ${r.gr == 4.0 ? 'selected' : ''}>A+ (4.0)</option>
                            <option value="3.75" ${r.gr == 3.75 ? 'selected' : ''}>A (3.75)</option>
                            <option value="3.5" ${r.gr == 3.5 ? 'selected' : ''}>A- (3.5)</option>
                            <option value="3.25" ${r.gr == 3.25 ? 'selected' : ''}>B+ (3.25)</option>
                            <option value="3.0" ${r.gr == 3.0 ? 'selected' : ''}>B (3.0)</option>
                        </select>
                        <button onclick="remGpa(${r.id})" class="text-slate-200"><i class="fa-solid fa-circle-xmark text-xl"></i></button>
                    </div>
                `).join('');
                let tCr = 0, tPt = 0;
                state.gpa.forEach(r => { tCr += parseFloat(r.cr); tPt += (r.cr * r.gr); });
                document.getElementById('gpa-val').innerText = tCr ? (tPt/tCr).toFixed(2) : "0.00";
            }

            if(state.activeTab === 'faculty') {
                document.getElementById('faculty-grid').innerHTML = FACULTY.map(f => `
                    <div class="card">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 bg-indigo-600 text-white rounded-xl flex items-center justify-center font-black">${f.id}</div>
                            <div>
                                <p class="font-extrabold text-slate-800 text-sm">${f.n}</p>
                                <p class="text-[9px] font-black text-indigo-500 uppercase tracking-widest">${f.r}</p>
                            </div>
                        </div>
                        <a href="tel:${f.p}" class="block bg-slate-900 text-white text-center py-3 rounded-xl text-[10px] font-black uppercase tracking-widest">Call Now</a>
                    </div>
                `).join('');
            }
        }

        // Helpers
        function addTask() {
            const input = document.getElementById('task-in');
            if(input.value.trim()) {
                state.tasks.push({txt: input.value});
                input.value = '';
                localStorage.setItem('mgt_tasks_v2', JSON.stringify(state.tasks));
                render();
            }
        }
        function delTask(i) { state.tasks.splice(i, 1); localStorage.setItem('mgt_tasks_v2', JSON.stringify(state.tasks)); render(); }
        function addGpaRow() { state.gpa.push({id: Date.now(), cr: 3, gr: 4.0}); render(); }
        function remGpa(id) { state.gpa = state.gpa.filter(r => r.id !== id); render(); }
        function upGpa(id, k, v) { const r = state.gpa.find(x => x.id === id); if(r) r[k] = parseFloat(v); localStorage.setItem('mgt_gpa_v2', JSON.stringify(state.gpa)); render(); }

        window.onload = () => {
            checkFirstTime();
            setInterval(() => {
                const now = new Date();
                document.getElementById('clock').innerText = now.toLocaleTimeString('en-GB');
                const options = { weekday: 'long', month: 'short', day: '2-digit' };
                document.getElementById('date-label').innerText = now.toLocaleDateString('en-US', options);
            }, 1000);
            render();
        };
    </script>
</body>
</html>
